language: ruby
cache:
  directories:
    - discourse/vendor/bundle
services:
  - postgresql
  - redis-server
addons:
  postgresql: 9.3
  apt:
    packages:
    - gifsicle
    - jpegoptim
    - optipng
    - jhead
  code_climate:
    repo_token: 34de2e1d1093068fa2e757bfce3a6214ae11c4b3f63bf36d81ec105c04ac2463
services:
  - redis-server
rvm:
  - 2.0.0
env:
  - LOAD_PLUGINS=1 RUN_COVERAGE=1
before_install:
  - cd discourse
  - git init
  - git remote add -t \* -f origin https://github.com/discourse/discourse.git
  - git checkout tags/latest-release
  - mkdir plugins/discourse-nntp-bridge
  - cd ..
  - shopt -s extglob dotglob
  - mv !(discourse) discourse/plugins/discourse-nntp-bridge/
  - shopt -u dotglob
  - cd discourse
script:
  - bundle exec rake db:create db:migrate
  - bundle exec rspec plugins/discourse-nntp-bridge/spec
